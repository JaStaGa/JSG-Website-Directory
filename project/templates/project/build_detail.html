<!-- project/build_detail.html -->

{% extends "project/base.html" %}
{% block title %}{{ build.name }}{% endblock %}
{% block content %}
  <h1>{{ build.name }}</h1>
  <p>Created at: {{ build.created_at }}</p>
  <p><strong>Height:</strong> {{ build.height_feet }}'{{ build.height_inches }}</p>

  <p>
    <a href="{% url 'build_edit' build.pk %}">Edit this build</a> |
    <a href="{% url 'build_delete' build.pk %}">Delete this build</a> |
    <a href="{% url 'build_list' %}">Back to all builds</a>
  </p>
<br>
  <h2>Badges You Chose</h2>
  {% if chosen_badges %}
    <ul>
      {% for name, lvl in chosen_badges %}
        <li>{{ name }} ({{ lvl }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>No badges selected.</em></p>
  {% endif %}
<br>
  <h2>Unlocked Badges</h2>
  {% if extra_badges %}
    <ul>
      {% for name, lvl in extra_badges %}
        <li>{{ name }} ({{ lvl }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>No additional badges unlocked by your attributes.</em></p>
  {% endif %}
<br>
  <h2>Attributes Above 25</h2>
  {% if raised_attrs %}
    <!-- load Plotly -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <div id="detail-attr-chart"
         style="width:100%;max-width:800px;height:400px;margin-bottom:2rem;">
    </div>

    <script>
      // parse our JSON-encoded lists
      const names   = JSON.parse('{{ attr_names_json|escapejs }}');
      const values  = JSON.parse('{{ attr_values_json|escapejs }}');
      const cats    = JSON.parse('{{ attr_cats_json|escapejs }}');

      // optional: map categories to colors
      const categoryColors = {
        'Finishing':    '#1f77b4',
        'Shooting':     '#2ca02c',
        'Playmaking':   '#ff7f0e',
        'Defense':      '#d62728',
        'Rebounding':   '#9467bd',
        'Physicals':    '#bcbd22'
      };
      const barColors = cats.map(c => categoryColors[c] || '#888');

      Plotly.newPlot('detail-attr-chart', [{
        x: names,
        y: values,
        type: 'bar',
        marker: { color: barColors, line:{ width:1, color:'#333' } },
        width: 0.5    // make bars thinner for more breathing room
      }], {
        paper_bgcolor: '#0d1b2a',
        plot_bgcolor:  '#0d1b2a',
        font:          { color: 'white' },
        yaxis:         { range: [0, 99], title: 'Attribute Value' },
        xaxis:         { tickangle: -45 },
        margin:        { b: 120 },
        bargap:        0.8
      }, { displayModeBar: false });
    </script>
  {% else %}
    <p><em>All attributes remain at base 25.</em></p>
  {% endif %}


  <p><a href="{% url 'build_list' %}">‚Üê Back to Builds</a></p>
{% endblock %}
