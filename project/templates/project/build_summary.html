<!-- project/build_summary.html -->

{% extends "project/base.html" %}
{% block title %}Build Summary{% endblock %}
{% block content %}
  <h1>Build: {{ build.name }}</h1>
  <p><strong>Height:</strong> {{ build.height_feet }}'{{ build.height_inches }}</p>

  <h2>Badges You Chose</h2>
  {% if chosen_badges %}
    <ul>
      {% for name, lvl in chosen_badges %}
        <li>{{ name }} ({{ lvl }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>No badges selected yet.</em></p>
  {% endif %}

  <h2>Newly Unlocked Badges</h2>
  {% if extra_badges %}
    <ul>
      {% for name, lvl in extra_badges %}
        <li>{{ name }} ({{ lvl }})</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>None unlocked by your attribute upgrades yet.</em></p>
  {% endif %}

  <h2>Attributes Raised Above 25</h2>
  <!-- {% if raised_attrs %}
    <ul>
      {% for name, val in raised_attrs %}
        <li>{{ name }}: {{ val }}</li>
      {% endfor %}
    </ul>
  {% else %}
    <p><em>No attribute has moved above the base of 25.</em></p>
  {% endif %} -->

  <!-- Plotly -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <div id="attr-chart" style="width:100%;max-width:800px;height:400px;margin-bottom:2rem;"></div>
  <script>
    // 1) grab our JSON arrays from Django
    const names   = JSON.parse('{{ attr_names_json|escapejs }}');
    const values  = JSON.parse('{{ attr_values_json|escapejs }}');
    const catList = JSON.parse('{{ attr_cats_json|escapejs }}');

    // 2) map each category to a color
    const categoryColors = {
      'Finishing':    '#1f77b4',
      'Shooting':     '#2ca02c',
      'Playmaking':   '#ff7f0e',
      'Defense':      '#d62728',
      'Rebounding':   '#9467bd',
      'Physicals':    '#bcbd22'
    };
    const barColors = catList.map(c => categoryColors[c] || '#888');

    // 3) plot
    Plotly.newPlot('attr-chart', [{
      x: names,
      y: values,
      type: 'bar',
      width: 0.6, 
      marker: { color: barColors, line:{ width:1, color:'#333' } }
    }], {
      paper_bgcolor: '#15151b',
      plot_bgcolor:  '#15151b',
      font:   { color: 'white' },
      // title:  { text:'Attributes Raised Above 25', font:{ color:'orange' } },
      yaxis:  { range:[0,99], title:'Attribute Value' },
      xaxis:  { tickangle:-45 },
      margin: { b:100 },
      bargap: 0.6, 
    }, { displayModeBar:false });
  </script>

  <p>
    <a href="{% url 'build_add_badge' %}">Add another badge</a> |
    <a href="{% url 'build_detail' build.pk %}">Finish & View Build</a>
  </p>
{% endblock %}

